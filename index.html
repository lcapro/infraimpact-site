<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>InfraImpact - MKI & LCA-berekeningen voor de GWW | Duurzaamheid die stand houdt</title>
  <meta name="description" content="InfraImpact helpt aannemers, opdrachtgevers en leveranciers met MKI- en LCA-berekeningen, aanbestedingsadvies en praktische sturing op duurzaamheid in de GWW-sector.">

  <!-- Favicons & App Icons -->
  <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="../assets/favicon.png">
  <link rel="icon" type="image/webp" sizes="32x32" href="../assets/favicon.webp">
  <link rel="apple-touch-icon" sizes="180x180" href="../assets/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="../assets/apple-touch-icon.webp">
  <meta name="theme-color" content="#2F6F65">

  <!-- Canonical + Hreflang -->
  <link rel="canonical" href="https://infraimpact.nl/"/>
  <link rel="alternate" hreflang="nl" href="https://infraimpact.nl/">

  <!-- Performance hints -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <!-- Preload hero/profielfoto (sneller first paint) -->
  <link rel="preload" as="image" href="../assets/logo_full.webp" type="image/webp" fetchpriority="high">
  <link rel="preload" as="image" href="../assets/jim_profile.webp" type="image/webp">

  <!-- Open Graph / Twitter -->
  <meta property="og:title" content="InfraImpact – Duurzaamheid die stand houdt">
  <meta property="og:description" content="MKI- en LCA-berekeningen, aanbestedingsadvies en praktische sturing voor de GWW-sector.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://infraimpact.nl/">
  <meta property="og:site_name" content="InfraImpact">
  <meta property="og:image" content="/assets/og-infraimpact.webp">
  <meta property="og:image" content="/assets/og-infraimpact.jpg">
  <meta property="og:image:alt" content="InfraImpact – MKI & LCA-berekeningen voor de GWW">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:locale" content="nl_NL">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="InfraImpact – MKI & LCA-berekeningen voor de GWW">
  <meta name="twitter:description" content="MKI- en LCA-berekeningen, aanbestedingsadvies en praktische sturing voor de GWW-sector.">
  <meta name="twitter:image" content="..//assets/og-infraimpact.jpg">

  <!-- Libraries -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <script async src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    :root { --brand-green:#2F6F65; --brand-blue:#2B536D; --ink:#374151; }
    body {
      background: linear-gradient(120deg,#ffffff,#f8fbfd,#e8f3f0,#eaf3f7);
      background-size: 400% 400%; animation: bgMove 60s ease infinite;
      color: var(--ink); font-family: ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;
    }
    @keyframes bgMove { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
    header { background: transparent; }
    .text-gradient {
      background: linear-gradient(90deg,var(--brand-green),var(--brand-blue));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      display:inline-block;
      padding-bottom:0.2em;
      overflow:visible;
    }
    [data-animate]{opacity:0;transform:translateY(24px);transition:opacity .7s ease,transform .7s ease}
    [data-animate].visible{opacity:1;transform:translateY(0)}
    .section-brand{background-color:#E5EFED}
    nav{position:sticky;top:0;background-color:#ffffffcc;backdrop-filter:blur(6px);box-shadow:0 2px 8px rgba(0,0,0,.05);transition:transform .3s ease,box-shadow .3s ease;z-index:50}
    .scroll-down{transform:translateY(-100%)} .scroll-up{transform:translateY(0)}
    :focus-visible{outline:3px solid var(--brand-green);outline-offset:3px}
    html{scroll-behavior:smooth} [id]{scroll-margin-top:96px}
    a.button, a.px-6, a.px-8{transition:transform .2s ease, background-color .2s ease, box-shadow .2s ease}
    a.button:hover, a.px-6:hover, a.px-8:hover{transform:translateY(-1px)}
    @media (prefers-reduced-motion: reduce){*{animation-duration:.001ms!important;animation-iteration-count:1!important;transition:none!important}}
    h1, h2 { line-height:1.25; overflow:visible }
  </style>

  <!-- Structured data: WebSite -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebSite",
    "name":"InfraImpact",
    "url":"https://infraimpact.nl",
    "potentialAction":{"@type":"SearchAction","target":"https://infraimpact.nl/?q={search_term_string}","query-input":"required name=search_term_string"}
  }
  </script>

  <!-- (Optioneel) Organization schema op de home -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Organization",
    "name":"InfraImpact B.V.",
    "url":"https://infraimpact.nl",
    "logo":"https://infraimpact.nl/assets/logo_full.png",
    "email":"mailto:info@infraimpact.nl",
    "telephone":"+31621350805",
    "address":{"@type":"PostalAddress","streetAddress":"Westzeedijk 639","postalCode":"3024 PJ","addressLocality":"Rotterdam","addressCountry":"NL"},
    "sameAs":[]
  }
  </script>

  <!-- =========================
       CONSENT MODE v2 + GA4
       ========================= -->
  <script>
    // Defaults: alles 'denied' tot de bezoeker kiest
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('consent','default',{
      ad_storage:'denied',
      analytics_storage:'denied',
      ad_user_data:'denied',
      ad_personalization:'denied'
    });
  </script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-9578ZQ8GWD"></script>
  <script>
    gtag('js', new Date());
    // GA pas activeren nadat Statistiek is geaccepteerd
    function enableAnalytics(){
      gtag('consent','update',{ analytics_storage:'granted' });
      gtag('config','G-9578ZQ8GWD',{ anonymize_ip:true, cookie_flags:'SameSite=None;Secure' });
    }
  </script>
  <!-- /Consent Mode + GA4 -->

</head>

<body class="bg-transparent text-gray-700">
  <div id="top"></div>

  <!-- NAV -->
  <nav id="nav" class="transition-transform duration-300">
    <div class="max-w-screen-xl mx-auto flex justify-between items-center py-4 px-6 sm:px-8">
      <a href="/" class="flex items-center">
        <img src="assets/logo_full.png" alt="InfraImpact logo" class="h-10 w-auto hover:opacity-90 transition"/>
      </a>
      <div class="hidden md:flex items-center space-x-8 text-gray-700 font-medium">
        <a href="/" class="hover:text-green-700">Home</a>
        <a href="/#wat" class="hover:text-green-700">Wat we doen</a>
        <a href="/#inzicht" class="hover:text-green-700">Inzichten</a>
        <div hidden> <a href="#inzicht" class="hover:text-green-700">Projecten</a> </div>
        <a href="../epd-checker/" class="hover:text-green-700">MKI-toetsing asfalt</a>
        <a href="../over/" class="hover:text-green-700">Over ons</a>
        <a href="#contact" class="hover:text-green-700">Contact</a>
        <a href="mailto:info@infraimpact.nl" class="inline-flex items-center px-4 py-2 rounded-xl bg-green-600 text-white hover:bg-green-500 cta">Plan kennismaking</a>
      </div>
      <!-- Mobile menu button -->
      <button id="menuBtn" class="md:hidden p-2 rounded hover:bg-gray-100" aria-expanded="false" aria-controls="mobileMenu" aria-label="Menu">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
    </div>
    <div id="mobileMenu" class="md:hidden hidden border-t bg-white">
      <div class="max-w-screen-xl mx-auto px-6 sm:px-8 py-3 space-y-2">
        <a href="/" class="block py-2">Home</a>
        <a href="/#wat" class="block py-2">Wat we doen</a>
        <a href="/#inzicht" class="block py-2">Inzichten</a>
        <div hidden> <a href="#inzicht" class="block py-2">Projecten</a> </div>
        <a href="../epd-checker/" class="block py-2">MKI-toetsing asfalt</a>
        <a href="../over/" class="block py-2">Over</a>
        <a href="#contact" class="block py-2">Contact</a>
        <a href="mailto:info@infraimpact.nl" class="inline-flex items-center px-4 py-2 rounded-xl bg-green-600 text-white hover:bg-green-500 cta">Plan kennismaking</a>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <header class="relative bg-transparent">
    <section class="max-w-screen-xl mx-auto w-full px-6 sm:px-8 grid md:grid-cols-2 gap-10 items-center py-20 md:py-28" style="isolation:isolate">
      <div data-animate>
        <p class="text-green-500 font-semibold uppercase tracking-wide">Making sustainability count</p>
        <h1 class="text-4xl md:text-6xl font-extrabold leading-[1.28] md:leading-[1.26] mt-2 pb-1 md:pb-2 text-gradient overflow-visible">
          Duurzaamheid die stand houdt, in cijfers en in de praktijk
        </h1>
        <p class="text-lg mt-5 text-gray-700 leading-relaxed pb-1 overflow-visible">
          InfraImpact helpt aannemers, opdrachtgevers en leveranciers om duurzaamheid
          <strong>tastbaar, toetsbaar en toepasbaar</strong> te maken.
          Met betrouwbare <strong>MKI- en LCA-data</strong>, aanbestedingskennis en ervaring aan beide kanten van de tafel vertalen we ambities naar aantoonbare resultaten.
        </p>
        <div class="mt-8 flex flex-wrap gap-4">
          <a href="mailto:info@infraimpact.nl" class="px-6 py-3 rounded-xl bg-green-600 hover:bg-green-500 transition text-white font-medium cta">
            Plan een kennismaking
          </a>
        </div>
      </div>

      <div class="hidden md:flex justify-center items-center" data-animate>
        <img src="assets/logo_full.webp" alt="InfraImpact visual"
             width="640" height="320" loading="lazy" decoding="async"
             class="max-h-80 w-auto object-contain opacity-0 transition-opacity duration-1000"
             onload="this.style.opacity='1'" />
      </div>
    </section>
  </header>

  <main>
    <!-- WAT WE DOEN -->
    <section id="wat" class="w-full py-20 md:py-24 bg-gray-50">
      <div class="max-w-screen-xl mx-auto px-6 sm:px-8">
        <div class="max-w-3xl mx-auto text-center mb-12" data-animate>
          <h2 class="text-3xl md:text-4xl font-bold text-gradient mb-4">Wat we doen</h2>
          <p class="text-gray-700">
            Wij maken duurzaamheid praktisch voor aannemers, opdrachtgevers en leveranciers.
            Van het opstellen van MKI-berekeningen tot strategisch advies in aanbestedingen en beleid.
          </p>
        </div>

        <div class="grid md:grid-cols-3 gap-6" data-animate>
          <div class="p-6 bg-white rounded-2xl shadow-sm hover:shadow-md transition-transform hover:-translate-y-1 md:col-span-1">
            <h3 class="text-xl font-semibold mb-2">LCA & MKI-berekeningen</h3>
            <p>Betrouwbare milieuprestaties van producten, materialen en projecten, conform huidige richtlijnen.
               Van volledige <a href="../over/#voor-wie" class="underline hover:text-green-700">MKI-berekeningen</a> tot LCA’s voor aanbestedingen en ontwerpoptimalisaties.</p>
          </div>

          <div class="p-6 bg-white rounded-2xl shadow-sm hover:shadow-md transition-transform hover:-translate-y-1 md:col-span-1">
            <h3 class="text-xl font-semibold mb-2">Aanbesteding & projectadvies</h3>
            <p>Voor aannemers leggen we kosten en MKI naast elkaar om het optimale resultaat te behalen in aanbestedingen.
               Praktisch, onderbouwd en direct toepasbaar binnen de eisen van opdrachtgevers.</p>
          </div>

          <div class="p-6 bg-white rounded-2xl shadow-sm hover:shadow-md transition-transform hover:-translate-y-1 md:col-span-1">
            <h3 class="text-xl font-semibold mb-2">Kennis & opleidingen</h3>
            <p>Praktijkgerichte cursussen en incompany trainingen. Van basis MKI tot verdieping in regelgeving en LCA-methodiek.</p>
          </div>

          <!-- CTA-kaart naar de checker -->
          <div class="p-6 bg-white rounded-2xl shadow ring-1 ring-green-100 md:col-span-3 flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
            <div>
              <h3 class="text-xl font-semibold mb-1">Tool: MKI-toetsing asfalt</h3>
              <p class="text-gray-700">Upload EPD’s en toets ze direct aan de NPDW MKI-plafondwaarden (PCR 2.0). Compact, duidelijk en exporteerbaar.</p>
            </div>
            <a href="../epd-checker/" class="inline-flex items-center px-5 py-3 rounded-xl bg-green-600 text-white hover:bg-green-500 cta">Start de check</a>
          </div>
        </div>
      </div>
    </section>

    <!-- INZICHTEN / DONUT -->
    <section id="inzicht" class="py-20 md:py-24 section-brand">
      <div class="max-w-screen-xl mx-auto px-6 sm:px-8 grid md:grid-cols-2 gap-10 items-center">
        <div data-animate>
          <div class="max-w-md mx-auto">
            <canvas id="impactChart" class="w-full h-56"
                    aria-label="Donutdiagram MKI-aandelen per levenscyclusfase" role="img"></canvas>
          </div>
          <p id="chart-desc" class="sr-only">
            Donutdiagram toont het MKI-aandeel per levenscyclusfase (som = 100%):
            Grondstoffen &amp; productie 55%, Transport 10%, Bouwfase 15%, Gebruik &amp; onderhoud 15%, Einde levensduur 5%.
          </p>
        </div>
        <div data-animate class="overflow-visible">
          <h2 class="text-3xl md:text-4xl font-bold text-gradient mb-4 leading-[1.28] md:leading-[1.24] pb-[2px] overflow-visible">Van data naar dialoog</h2>
          <p class="text-gray-700 mb-6 leading-relaxed pb-[1px] overflow-visible">
            Compact overzicht van de MKI-verdeling: in één oogopslag zie je waar het grootste aandeel zit
            en dus waar sturing het meeste oplevert.
          </p>
          <ul class="space-y-3 text-gray-700">
            <li>• Inzicht in MKI en CO₂ per projectfase</li>
            <li>• Scenario’s en optimalisaties</li>
            <li>• Onderbouwingen voor aanbestedingen en audits</li>
            <li>• Strategisch advies en beleidsondersteuning</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- QUOTE -->
    <section class="py-16">
      <div class="max-w-3xl mx-auto text-center px-6 sm:px-8" data-animate>
        <blockquote class="text-xl italic text-gray-700 leading-relaxed">
          <strong>“Wij kennen beide kanten van de tafel.”</strong><br>
          Ervaring bij zowel aannemers als opdrachtgevers zorgt dat we begrijpen wat werkt in de praktijk.
        </blockquote>
      </div>
    </section>
  </main>

  <!-- FOOTER / CONTACT -->
  <footer id="contact" class="bg-white rounded-t-3xl shadow-inner pt-16 pb-10">
    <div class="max-w-screen-md mx-auto px-6 sm:px-8 text-center" data-animate>
      <h2 class="text-3xl md:text-4xl font-bold text-gradient mb-6">Samen bouwen aan aantoonbare duurzaamheid</h2>
      <p class="text-gray-700 mb-8">Benieuwd hoe jouw organisatie voordeel haalt uit MKI & LCA? We denken graag mee en reageren dezelfde werkdag.</p>
      <div class="space-y-2 text-gray-600">
        <p><strong>InfraImpact B.V.</strong></p>
        <p>Westzeedijk 639, 3024 PJ Rotterdam</p>
        <p>E: <a href="mailto:info@infraimpact.nl" class="text-green-700 underline">info@infraimpact.nl</a></p>
        <p>T: <a href="tel:+31621350805" class="text-green-700 underline">+31 (0)6 2135 0805</a></p>
      </div>
      <div class="mt-8">
        <a href="mailto:info@infraimpact.nl" class="px-8 py-3 rounded-xl bg-green-600 hover:bg-green-500 transition text-white font-medium cta">
          Plan een kennismaking
        </a>
      </div>
      <p class="text-gray-500 text-sm mt-6">
        <a href="../privacy/" class="underline">Privacy</a> ·
        <a href="../cookies/" class="underline">Cookiebeleid</a> ·
        <a href="../algemene-voorwaarden/" class="underline">Algemene voorwaarden</a> ·
        <a id="cookieSettingsLink" href="#cookie-instellingen" class="underline">Cookie-instellingen</a>
      </p>
      <p class="text-gray-500 text-sm mt-6">
        © <span id="year"></span> InfraImpact - Making sustainability count.
      </p>
    </div>
  </footer>

  <!-- Achtergrond-streaks -->
  <canvas id="streaks" class="fixed inset-0 w-full h-full" style="z-index:-1;"></canvas>

  <script>
    // Jaar
    document.getElementById('year').textContent = new Date().getFullYear();

    // Mobile menu toggle
    const btn = document.getElementById('menuBtn');
    const menu = document.getElementById('mobileMenu');
    if (btn && menu) {
      btn.addEventListener('click', () => {
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!expanded));
        menu.classList.toggle('hidden');
      });
      document.querySelectorAll('#mobileMenu a').forEach(a => {
        a.addEventListener('click', () => {
          menu.classList.add('hidden');
          btn.setAttribute('aria-expanded','false');
        });
      });
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !menu.classList.contains('hidden')) {
          menu.classList.add('hidden');
          btn.setAttribute('aria-expanded','false');
        }
      });
    }

    // Reveal on scroll
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1 });
    document.querySelectorAll('[data-animate]').forEach(el => observer.observe(el));

    // Sticky nav show/hide op scrollrichting
    let lastY = window.scrollY; const nav = document.getElementById('nav');
    window.addEventListener('scroll', () => {
      const y = window.scrollY;
      if (y > lastY && y > 80) nav.classList.add('scroll-down'), nav.classList.remove('scroll-up');
      else nav.classList.add('scroll-up'), nav.classList.remove('scroll-down');
      lastY = y;
    }, { passive: true });

    // =========================
    //  MKI-donut labels
    // =========================
    window.addEventListener('load', function(){
      const canvas = document.getElementById('impactChart');
      if (!canvas || !window.Chart) return;

      const labelsFull = ['Grondstoffen & productie','Transport','Bouwfase','Gebruik & onderhoud','Einde levensduur'];
      const labelsShort = ['Productie','Transport','Bouw','Gebruik','Einde levensduur'];
      const values = [55, 10, 15, 15, 5];
      const colors = ['#2F6F65','#2B536D','#7ADAD3','#F59E0B','#9CA3AF'];

      function roundRect(ctx, x, y, w, h, r){
        const rr = Math.min(r, h/2, w/2);
        ctx.beginPath();
        ctx.moveTo(x+rr, y);
        ctx.arcTo(x+w, y, x+w, y+h, rr);
        ctx.arcTo(x+w, y+h, x, y+h, rr);
        ctx.arcTo(x, y+h, x, y, rr);
        ctx.arcTo(x, y, x+w, y, rr);
        ctx.closePath();
      }

      const overrides = { 0:{dx:18}, 4:{dy:-24} };

      const labelsNoLines = {
        id: 'labelsNoLines',
        afterDatasetsDraw(chart) {
          const { ctx, chartArea:{ top,bottom,left,right } } = chart;
          const meta = chart.getDatasetMeta(0);
          if (!meta || !meta.data) return;

          const DPR = window.devicePixelRatio || 1;
          ctx.save(); ctx.font = '13px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto'; ctx.lineWidth = 1 * DPR;

          const offset = 34, lineH = 19, tether = 28, padX = 8, padY = 5;
          const maxTextWidth = Math.min(180, (right-left)*0.33), marginX = 16, marginTop = 20, marginBottom = 16;

          const items = meta.data.map((arc, i) => {
            const mid = (arc.startAngle + arc.endAngle) / 2;
            const cos = Math.cos(mid), sin = Math.sin(mid);
            const rOuter = arc.outerRadius;

            const anchor = { x: arc.x + cos*(rOuter+offset), y: arc.y + sin*(rOuter+offset) };
            const rightSide = cos >= 0;
            const label = `${labelsShort[i]} ${values[i]}%`;

            const w = ctx.measureText(label).width;
            let line1 = label, line2 = '';
            let width = w;
            if (w > maxTextWidth) {
              const parts = label.split(' ');
              line1 = ''; line2 = '';
              for (let k=0;k<parts.length;k++){
                const test = (line1 ? line1+' ' : '') + parts[k];
                if (ctx.measureText(test).width <= maxTextWidth) line1 = test; else { line2 = parts.slice(k).join(' '); break; }
              }
              width = Math.max(ctx.measureText(line1).width, ctx.measureText(line2).width);
            }
            const lines = line2 ? [line1,line2] : [line1];
            const textHeight = lines.length*14 + (lines.length-1)*2;
            const xTextRaw = rightSide ? anchor.x + 8 : anchor.x - 8;

            return { i, rightSide, anchor, w:width, textHeight, lines, xTextRaw, y0:anchor.y, xText:0, yText:0 };
          });

          items.forEach(it=>{
            const boxW = it.w + 2*padX;
            if (it.rightSide) it.xText = Math.min(it.xTextRaw, right - marginX - boxW + padX);
            else it.xText = Math.max(it.xTextRaw, left + marginX + boxW - padX);
            it.yText = it.y0;
          });

          function layoutSide(sideItems){
            if (!sideItems.length) return;
            sideItems.sort((a,b)=>a.y0-b.y0);
            const minY = top + marginTop, maxY = bottom - marginBottom;

            sideItems[0].yText = Math.max(Math.min(sideItems[0].y0, maxY), minY);
            for (let k=1;k<sideItems.length;k++){
              const prev = sideItems[k-1], cur = sideItems[k];
              const need = prev.yText + prev.textHeight + lineH;
              cur.yText = Math.max(cur.y0, need);
            }
            for (let k=sideItems.length-2;k>=0;k--){
              const next = sideItems[k+1], cur = sideItems[k];
              const maxAllowed = next.yText - (cur.textHeight + lineH);
              cur.yText = Math.min(cur.yText, maxAllowed);
            }
            sideItems.forEach(it=>{
              const halfH = it.textHeight/2;
              if (it.yText > it.y0 + tether) it.yText = it.y0 + tether;
              if (it.yText < it.y0 - tether) it.yText = it.y0 - tether;
              it.yText = Math.min(Math.max(it.yText, minY), maxY - it.textHeight + halfH);
            });
          }
          const leftSide = items.filter(i=>!i.rightSide);
          const rightSide = items.filter(i=>i.rightSide);
          layoutSide(leftSide); layoutSide(rightSide);

          items.forEach(it=>{
            const o = overrides[it.i]; if (o){ if (o.dx) it.xText += o.dx * (it.rightSide?1:-1); if (o.dy) it.yText += o.dy; }
            const boxW = it.w + 2*padX;
            if (it.rightSide) it.xText = Math.min(it.xText, right - marginX - boxW + padX);
            else it.xText = Math.max(it.xText, left + marginX + boxW - padX);
          });

          items.forEach(it=>{
            const boxW = it.w + 2*padX, boxH = it.textHeight + 2*padY;
            const boxX = it.rightSide ? it.xText - padX : it.xText - boxW + padX;
            const boxY = it.yText - (boxH/2);

            ctx.save();
            ctx.shadowColor = 'rgba(0,0,0,0.06)'; ctx.shadowBlur = 6; ctx.shadowOffsetY = 2;
            ctx.fillStyle = 'rgba(255,255,255,0.95)'; roundRect(ctx, boxX, boxY, boxW, boxH, 6); ctx.fill();
            ctx.restore();

            ctx.fillStyle = '#111827'; ctx.textBaseline = 'middle'; ctx.textAlign = it.rightSide ? 'left' : 'right';
            const lineY0 = it.yText - ((it.lines.length-1) * 8);
            it.lines.forEach((line, idx)=>{ const y = lineY0 + idx*16; ctx.fillText(line, it.rightSide?(boxX+padX):(boxX+boxW-padX), y); });
          });

          ctx.restore();
        }
      };

      new Chart(canvas, {
        type: 'doughnut',
        data: { labels: labelsFull, datasets: [{ data: values, backgroundColor: colors, borderWidth: 0, hoverOffset: 8 }] },
        options: {
          responsive:true, maintainAspectRatio:true, aspectRatio:1.6, cutout:'62%',
          layout:{ padding:{ top:36, right:40, bottom:28, left:40 } },
          plugins:{ legend:{ display:false }, tooltip:{ callbacks:{ label:(i)=>`${i.label}: ${i.parsed}%`, afterBody:(items)=>items[0].dataIndex===0?['Hier valt de meeste winst te behalen.']:[] } } },
          animation:{ duration:600 }
        },
        plugins:[labelsNoLines]
      });
    });

    // Decoratieve streaks-animatie
    const c = document.getElementById('streaks');
    const ctx2 = c.getContext('2d');
    let w, h;
    function resize(){ w=window.innerWidth; h=window.innerHeight; c.width=w; c.height=h; }
    window.addEventListener('resize', resize); resize();

    const streakColors=['rgba(47,111,101,0.22)','rgba(43,83,109,0.22)','rgba(255,255,255,0.12)'];
    const streaks = Array.from({ length:45 }, ()=>({ x:Math.random()*w, y:Math.random()*h, l:Math.random()*80+40,
      s:Math.random()*0.2+0.05, o:Math.random()*0.3+0.1, d:Math.random()>0.5?1:-1, a:Math.random()*Math.PI*2, c:streakColors[Math.floor(Math.random()*streakColors.length)] }));

    function animate(){
      ctx2.clearRect(0,0,w,h);
      streaks.forEach(s=>{
        s.o += 0.01*s.d; if (s.o<=0 || s.o>=1) s.d*=-1;
        ctx2.beginPath(); const col = s.c.replace(/0\.\d+/, s.o.toFixed(2));
        ctx2.strokeStyle = col; ctx2.lineWidth = 1;
        const dx = Math.cos(s.a)*s.l, dy = Math.sin(s.a)*s.l;
        ctx2.moveTo(s.x,s.y); ctx2.lineTo(s.x+dx,s.y+dy); ctx2.stroke();
        s.x += Math.cos(s.a)*s.s; s.y += Math.sin(s.a)*s.s;
        if (s.x<-50 || s.x>w+50 || s.y<-50 || s.y>h+50){ s.x=Math.random()*w; s.y=-10; s.a=Math.random()*Math.PI*2; s.o=0; s.d=1; }
      });
      if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) requestAnimationFrame(animate);
    }
    animate();
  </script>

  <noscript>
    <style>[data-animate]{opacity:1;transform:none}</style>
  </noscript>

  <!-- GA4 event tracking (blijft werken zodra Statistiek is geaccepteerd) -->
  <script>
    function track(eventName, params){
      if (typeof gtag === 'function') gtag('event', eventName, params || {});
    }
    document.addEventListener('click', function(e){
      const a = e.target.closest('a'); if (!a) return;
      const href = (a.getAttribute('href') || '').toLowerCase();
      if (href.startsWith('mailto:')) track('generate_lead',{method:'mailto', email:href.replace('mailto:','')});
      if (href.startsWith('tel:')) track('generate_lead',{method:'tel', phone:href.replace('tel:','')});
      const text = (a.textContent || '').trim();
      if (a.classList.contains('cta') || /plan kennismaking|start de check|neem contact/i.test(text)){
        track('select_content',{content_type:'cta', link_text:text, url:location.pathname});
      }
    });
  </script>
  <!-- /GA4 event tracking -->

  <!-- =========================
       COOKIEBANNER + MODAL
       ========================= -->
  <div id="ci-banner" class="fixed inset-x-0 bottom-0 z-50 bg-white border-t shadow-lg hidden">
    <div class="max-w-screen-lg mx-auto p-4 sm:p-5 flex flex-col sm:flex-row sm:items-center gap-4">
      <div class="text-sm text-gray-800">
        <strong>Cookies bij InfraImpact</strong> – We gebruiken noodzakelijke cookies om de site goed te laten werken.
        Met jouw toestemming zetten we ook <em>analytische</em> cookies aan om het gebruik van de site te verbeteren.
        <a href="../cookies/" class="underline">Meer info</a>
      </div>
      <div class="flex gap-2 ml-auto">
        <button id="ci-preferences" class="px-3 py-2 rounded-lg border">Zelf instellen</button>
        <button id="ci-accept" class="px-3 py-2 rounded-lg bg-green-600 text-white">Alle cookies accepteren</button>
      </div>
    </div>
  </div>

  <div id="ci-modal" class="fixed inset-0 z-50 bg-black bg-opacity-40 hidden" aria-hidden="true">
    <div class="bg-white max-w-lg mx-auto mt-24 rounded-xl shadow-xl overflow-hidden">
      <div class="p-5 border-b">
        <h2 class="text-lg font-semibold">Cookie-instellingen</h2>
      </div>
      <div class="p-5 space-y-4 text-sm">
        <label class="flex items-start gap-3">
          <input type="checkbox" checked disabled>
          <span><strong>Noodzakelijk</strong> – altijd actief voor werking en beveiliging.</span>
        </label>
        <label class="flex items-start gap-3">
          <input id="ci-stat" type="checkbox" checked>
          <span><strong>Statistiek</strong> – Google Analytics, helpt ons de site te verbeteren.</span>
        </label>
      </div>
      <div class="p-5 border-t flex justify-end gap-2">
        <button id="ci-cancel" class="px-3 py-2 rounded-lg border">Annuleren</button>
        <button id="ci-save" class="px-3 py-2 rounded-lg bg-green-600 text-white">Opslaan</button>
      </div>
    </div>
  </div>

  <script>
  (function(){
    const KEY='cookie_consent';
    const $banner=document.getElementById('ci-banner');
    const $modal=document.getElementById('ci-modal');
    const $stat=document.getElementById('ci-stat');
    const btn=(id)=>document.getElementById(id);

    function read(){ try{return JSON.parse(localStorage.getItem(KEY)||'{}');}catch(e){return{}} }
    function save(v){ localStorage.setItem(KEY, JSON.stringify(v)); }
    function hideBanner(){ $banner.classList.add('hidden'); }
    function showBanner(){ $banner.classList.remove('hidden'); }
    function openModal(){ $modal.classList.remove('hidden'); $modal.setAttribute('aria-hidden','false'); }
    function closeModal(){ $modal.classList.add('hidden'); $modal.setAttribute('aria-hidden','true'); }

    // Externe open-trigger (footer/beleidspagina's)
    window.addEventListener('infraimpact:openCookieSettings', openModal);
    document.getElementById('cookieSettingsLink')?.addEventListener('click', (e)=>{ e.preventDefault(); openModal(); });

    function apply(consent){
      const stat = !!consent.statistics;
      $stat.checked = stat;
      if (stat && typeof enableAnalytics === 'function') enableAnalytics();
      if (typeof gtag === 'function') gtag('consent','update',{ analytics_storage: stat?'granted':'denied' });
    }

    btn('ci-accept').addEventListener('click', ()=>{
      const consent={ necessary:true, statistics:true, ts:Date.now() };
      save(consent); apply(consent); hideBanner();
    });
    btn('ci-preferences').addEventListener('click', openModal);
    btn('ci-cancel').addEventListener('click', closeModal);
    btn('ci-save').addEventListener('click', ()=>{
      const consent={ necessary:true, statistics:$stat.checked, ts:Date.now() };
      save(consent); apply(consent); closeModal(); hideBanner();
    });

    const existing = read();
    if (!('statistics' in existing)){
      $stat.checked = true;
      showBanner();
    } else {
      apply(existing);
    }
  })();
  </script>
  <!-- /COOKIEBANNER -->

</body>
</html>
