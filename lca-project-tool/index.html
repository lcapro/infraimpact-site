<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LCA project tool | lifecycle assessment support | InfraImpact</title>
  <meta name="description" content="Maak accounts aan, lees EPD's in en volg per levenscyclusfase de MKI- en CO2-waarden van materialen per project." />
  <!-- SEO: maximale indexatie + rijke snippets zonder zichtbare tekstwijziging -->
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1">
  <meta name="googlebot" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1">
  <meta name="author" content="InfraImpact B.V.">

  <!-- Canonical + Hreflang -->
  <link rel="canonical" href="https://infraimpact.nl/lca-project-tool/">
  <link rel="alternate" hreflang="nl" href="https://infraimpact.nl/lca-project-tool/">
  <link rel="alternate" hreflang="x-default" href="https://infraimpact.nl/lca-project-tool/">
  <link rel="me" href="https://mkiexpertisecentrum.nl/">

  <!-- Performance hints -->
  <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="../assets/favicon.png">
  <link rel="icon" type="image/webp" sizes="32x32" href="../assets/favicon.webp">
  <link rel="apple-touch-icon" sizes="180x180" href="../assets/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="../assets/apple-touch-icon.webp">
  <meta name="theme-color" content="#2F6F65">

  <script src="https://cdn.tailwindcss.com"></script>

  <script type="module">
    import * as pdfjsLib from "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.6.82/build/pdf.mjs";
    pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.6.82/build/pdf.worker.mjs";
    window.pdfjsLib = pdfjsLib;
  </script>

  <style>
    :root { --brand-green:#2F6F65; --brand-blue:#2B536D; --ink:#1f2937; }
    body {
      background: radial-gradient(circle at 20% 20%, #e5efed 0, transparent 35%),
                  radial-gradient(circle at 80% 0, #eaf3f7 0, transparent 30%),
                  linear-gradient(120deg,#ffffff,#f8fbfd,#e8f3f0,#eaf3f7);
      background-size: 160% 160%;
      animation: bgMove 36s ease infinite;
      color: var(--ink);
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
    }
    @keyframes bgMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .text-gradient {
      background: linear-gradient(90deg, var(--brand-green), var(--brand-blue));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      display: inline-block;
    }
    .card {
      border-radius: 1.25rem;
      background: #ffffff;
      box-shadow: 0 12px 28px rgba(0,0,0,0.05);
      border: 1px solid #ecf1f0;
    }
    .site-nav{position:sticky;top:0;background-color:rgba(255,255,255,0.92);backdrop-filter:blur(8px);box-shadow:0 2px 8px rgba(0,0,0,0.05);transition:transform .3s ease,box-shadow .3s ease;z-index:50}
    .scroll-down{transform:translateY(-100%)} .scroll-up{transform:translateY(0)}
    .grid-label { font-size: 0.9rem; font-weight: 600; }
    .mono { font-variant-numeric: tabular-nums; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    .hidden { display: none; }
    .nav-dropdown{position:relative}
    .nav-dropdown button{display:flex;align-items:center;gap:0.35rem}
    .nav-dropdown-menu{position:absolute;top:100%;left:0;min-width:16rem;background:#fff;border:1px solid rgba(15,23,42,0.08);border-radius:0.75rem;box-shadow:0 18px 40px rgba(15,23,42,0.12);padding:0.4rem;display:none;z-index:60}
    .nav-dropdown-menu a{display:block;padding:0.55rem 0.75rem;border-radius:0.6rem;white-space:nowrap}
    .nav-dropdown-menu a:hover{background:#ecfdf3;color:#2f6f65}
    .nav-dropdown:hover .nav-dropdown-menu,.nav-dropdown:focus-within .nav-dropdown-menu{display:block}
  </style>

  <!-- Structured data: tool + WebPage context -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"SoftwareApplication",
    "name":"LCA-project-tool",
    "applicationCategory":"EngineeringApplication",
    "operatingSystem":"Web",
    "creator":{"@type":"Organization","name":"InfraImpact B.V."},
    "offers":{"@type":"Offer","price":"0","priceCurrency":"EUR"},
    "url":"https://infraimpact.nl/lca-project-tool/"
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "@id":"https://infraimpact.nl/lca-project-tool/#webpage",
    "url":"https://infraimpact.nl/lca-project-tool/",
    "name":"LCA-project-tool | InfraImpact",
    "isPartOf":{"@type":"WebSite","@id":"https://infraimpact.nl/#website"},
    "about":[
      "LCA",
      "MKI",
      "EPD",
      "CO2",
      "Milieu-impact"
    ]
  }
  </script>
  <!-- Structured data: professional service + sameAs -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@graph":[
      {
        "@type":"Organization",
        "@id":"https://infraimpact.nl/#organization",
        "sameAs":[
          "https://mkiexpertisecentrum.nl/"
        ]
      },
      {
        "@type":"ProfessionalService",
        "@id":"https://infraimpact.nl/#professionalservice",
        "name":"InfraImpact B.V.",
        "url":"https://infraimpact.nl/",
        "provider":{"@id":"https://infraimpact.nl/#organization"},
        "areaServed":{"@type":"Country","name":"Netherlands"},
        "serviceType":[
          "MKI calculation",
          "LCA consultancy",
          "EPD support",
          "Infrastructure sustainability",
          "Environmental impact assessment",
          "Lifecycle assessment"
        ],
        "knowsAbout":[
          "MKI",
          "LCA",
          "EPD",
          "infrastructure sustainability",
          "environmental impact",
          "lifecycle assessment"
        ],
        "telephone":"+31 6 2135 0805",
        "email":"info@infraimpact.nl",
        "address":{
          "@type":"PostalAddress",
          "streetAddress":"Westzeedijk 639",
          "postalCode":"3024 PJ",
          "addressLocality":"Rotterdam",
          "addressCountry":"NL"
        }
      }
    ]
  }
  </script>

</head>
<body class="text-gray-800">
  <nav aria-label="Hoofdmenu" id="nav" class="site-nav border-b border-gray-100">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between py-3">
      <a href="/" class="flex items-center gap-2">
        <img src="../assets/logo_full.png" alt="InfraImpact logo" class="h-9 w-auto">
      </a>
      <div class="hidden md:flex items-center gap-6 text-sm font-medium">
        <a href="/" class="hover:text-green-700">Home</a>
        <div class="nav-dropdown">
          <button type="button" class="hover:text-green-700 font-medium" aria-haspopup="true">
            Tools
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.94l3.71-3.71a.75.75 0 1 1 1.06 1.06l-4.24 4.24a.75.75 0 0 1-1.06 0L5.21 8.29a.75.75 0 0 1 .02-1.08Z" clip-rule="evenodd"/>
            </svg>
          </button>
          <div class="nav-dropdown-menu">
            <a href="../epd-checker/">MKI-toetsing asfalt</a>
            <a href="../asfalt-lca-tool/">Asfalt LCA-tool</a>
            <span class="block px-3 py-2 text-green-700 font-semibold">LCA-project-tool</span>
          </div>
        </div>
        <div class="nav-dropdown">
          <button type="button" class="hover:text-green-700 font-medium" aria-haspopup="true">
            Kennis
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.94l3.71-3.71a.75.75 0 1 1 1.06 1.06l-4.24 4.24a.75.75 0 0 1-1.06 0L5.21 8.29a.75.75 0 0 1 .02-1.08Z" clip-rule="evenodd"/>
            </svg>
          </button>
          <div class="nav-dropdown-menu">
            <a href="/lca-gww/">LCA in de GWW</a>
            <a href="/mki-berekening-gww/">MKI-berekeningen</a>
            <a href="/epd-en-15804/">EPD &amp; normen</a>
            <a href="/lca-aanbestedingen-gww/">LCA in aanbestedingen</a>
            <a href="/artikelen/">Alle artikelen</a>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-8">
    <header class="space-y-3">
      <p class="text-green-700 font-semibold uppercase tracking-wide">Making sustainability count</p>
      <h1 class="text-3xl md:text-4xl font-extrabold text-gradient">LCA-project-tool</h1>
      <p class="max-w-3xl text-lg text-gray-700">
        Maak accounts aan voor aannemers en werkvoorbereiders, lees EPD's in, vul handmatig aan waar nodig
        en beheer per project de materialen, MKI/ECI en CO<sub>2</sub> (GWP) per levenscyclusfase. Default transportprofielen zijn ingericht op vrachtwagens Diesel Euro 5 en aanleg op diesel.
      </p>
    </header>

    <section id="authPage" class="card p-6 space-y-6">
      <div class="flex items-center justify-between flex-wrap gap-4">
        <div>
          <h2 class="text-xl font-semibold">Registreren of inloggen</h2>
          <p class="text-sm text-gray-600">Toegang voor GWW-teams met e-mailverificatie en herstel voor wachtwoordbeheer.</p>
        </div>
        <div id="authMessage" class="text-sm font-semibold"></div>
      </div>
      <div class="grid md:grid-cols-2 gap-6">
        <div class="space-y-3">
          <h3 class="font-semibold">Nieuw account</h3>
          <p class="text-sm text-gray-600">Registratie op e-mailbasis. Verifieer via de ontvangen link voor volledige toegang.</p>
          <div class="grid gap-3">
            <label class="space-y-1">
              <span class="grid-label">Naam</span>
              <input id="registerName" type="text" class="w-full border rounded-xl px-3 py-2" placeholder="Voor- en achternaam" />
            </label>
            <label class="space-y-1">
              <span class="grid-label">E-mail</span>
              <input id="registerEmail" type="email" class="w-full border rounded-xl px-3 py-2" placeholder="naam@bedrijf.nl" />
            </label>
            <label class="space-y-1">
              <span class="grid-label">Wachtwoord</span>
              <input id="registerPassword" type="password" class="w-full border rounded-xl px-3 py-2" placeholder="Minimaal 8 tekens" />
            </label>
            <button id="registerBtn" class="inline-flex justify-center px-4 py-2 rounded-xl bg-green-600 text-white font-semibold hover:bg-green-500">Account aanmaken</button>
            <p class="text-xs text-gray-500">Gegevens worden lokaal opgeslagen voor demo-doeleinden. Verificatie per e-mail is vereist voordat je kunt inloggen.</p>
          </div>
        </div>
        <div class="space-y-3">
          <h3 class="font-semibold">Aanmelden</h3>
          <p class="text-sm text-gray-600">Log in met een geverifieerd account om je persoonlijke omgeving te openen.</p>
          <div class="grid gap-3">
            <label class="space-y-1">
              <span class="grid-label">E-mail</span>
              <input id="loginEmail" type="email" class="w-full border rounded-xl px-3 py-2" placeholder="naam@bedrijf.nl" />
            </label>
            <label class="space-y-1">
              <span class="grid-label">Wachtwoord</span>
              <input id="loginPassword" type="password" class="w-full border rounded-xl px-3 py-2" placeholder="••••••••" />
            </label>
            <div class="flex flex-wrap gap-3 items-center">
              <button id="loginBtn" class="inline-flex justify-center px-4 py-2 rounded-xl bg-blue-700 text-white font-semibold hover:bg-blue-600">Inloggen</button>
              <button id="logoutBtn" class="hidden inline-flex justify-center px-4 py-2 rounded-xl bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300">Uitloggen</button>
              <button id="forgotLink" type="button" class="text-sm text-blue-700 hover:underline">Wachtwoord vergeten?</button>
            </div>
            <button id="resendVerification" type="button" class="text-sm text-amber-700 hover:underline hidden">Verificatiemail opnieuw versturen</button>
          </div>
        </div>
      </div>

      <div class="border-t pt-4 grid md:grid-cols-3 gap-6">
        <div class="space-y-3 md:col-span-1">
          <h3 class="font-semibold">Beveiligde toegang</h3>
          <p class="text-sm text-gray-600">Verifieer je e-mailadres of herstel je wachtwoord. Deze acties zijn gericht op teams in de GWW-sector en worden hieronder als demo-mail getoond.</p>
          <div id="resetRequest" class="space-y-2 hidden">
            <label class="space-y-1 block">
              <span class="grid-label">E-mail voor herstel</span>
              <input id="resetEmail" type="email" class="w-full border rounded-xl px-3 py-2" placeholder="naam@bedrijf.nl" />
            </label>
            <button id="requestReset" class="inline-flex justify-center px-4 py-2 rounded-xl bg-blue-700 text-white font-semibold hover:bg-blue-600">Verstuur herstel-link</button>
          </div>
          <div id="resetForm" class="space-y-2 hidden">
            <div class="text-sm text-gray-700" id="resetContext"></div>
            <label class="space-y-1 block">
              <span class="grid-label">Nieuw wachtwoord</span>
              <input id="newPassword" type="password" class="w-full border rounded-xl px-3 py-2" placeholder="Minimaal 8 tekens" />
            </label>
            <label class="space-y-1 block">
              <span class="grid-label">Herhaal wachtwoord</span>
              <input id="confirmPassword" type="password" class="w-full border rounded-xl px-3 py-2" placeholder="Bevestig wachtwoord" />
            </label>
            <button id="submitReset" class="inline-flex justify-center px-4 py-2 rounded-xl bg-green-600 text-white font-semibold hover:bg-green-500">Wachtwoord opslaan</button>
          </div>
        </div>
        <div class="md:col-span-2 space-y-3">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="font-semibold">Bevestigingsmail (demo)</h3>
              <p class="text-sm text-gray-600">Verificatie- en herstelmails verschijnen hieronder zodat je ze direct kunt openen.</p>
            </div>
            <span class="text-xs text-gray-500">Alleen zichtbaar in deze demo</span>
          </div>
          <div id="mailbox" class="grid gap-3"></div>
        </div>
      </div>
    </section>

    <section id="workspacePage" class="card p-6 space-y-8 hidden">
      <div class="flex flex-wrap items-center justify-between gap-4">
        <div>
          <h2 class="text-xl font-semibold">Persoonlijke omgeving</h2>
          <p class="text-sm text-gray-600">Beheer je instellingen en projecten. Elke gebruiker heeft zijn eigen projectdatabase.</p>
        </div>
        <div class="text-sm text-green-700 font-semibold" id="activeUser"></div>
      </div>

      <div class="grid md:grid-cols-3 gap-6">
        <div class="md:col-span-1 space-y-3">
          <h3 class="font-semibold">Persoonlijke instellingen</h3>
          <label class="space-y-1 block">
            <span class="grid-label">Naam</span>
            <input id="settingsName" class="w-full border rounded-xl px-3 py-2" />
          </label>
          <label class="space-y-1 block">
            <span class="grid-label">E-mail (alleen lezen)</span>
            <input id="settingsEmail" class="w-full border rounded-xl px-3 py-2 bg-gray-100" readonly />
          </label>
          <label class="space-y-1 block">
            <span class="grid-label">Functie / rol</span>
            <input id="settingsRole" class="w-full border rounded-xl px-3 py-2" placeholder="Werkvoorbereider, aannemer..." />
          </label>
          <label class="space-y-1 block">
            <span class="grid-label">Voorkeurseenheid</span>
            <input id="settingsUnit" class="w-full border rounded-xl px-3 py-2" placeholder="ton, m3, m2" />
          </label>
          <button id="saveSettings" class="inline-flex justify-center px-4 py-2 rounded-xl bg-green-600 text-white font-semibold hover:bg-green-500">Instellingen opslaan</button>
          <div id="settingsMessage" class="text-sm font-semibold"></div>
        </div>

        <div class="md:col-span-2 space-y-3">
          <div class="flex items-center justify-between flex-wrap gap-3">
            <div>
              <h3 class="font-semibold">Projectenoverzicht</h3>
              <p class="text-sm text-gray-600">Maak meerdere projecten aan en wissel per project van materiaaladministratie.</p>
            </div>
            <div class="text-xs text-gray-500" id="projectCount"></div>
          </div>
          <div class="grid gap-3 md:grid-cols-2">
            <label class="space-y-1 block">
              <span class="grid-label">Projectnaam</span>
              <input id="projectName" class="w-full border rounded-xl px-3 py-2" placeholder="Bijv. Verbreding N210" />
            </label>
            <label class="space-y-1 block">
              <span class="grid-label">Beschrijving</span>
              <input id="projectDescription" class="w-full border rounded-xl px-3 py-2" placeholder="Fase, opdrachtgever..." />
            </label>
            <button id="addProject" class="md:col-span-2 inline-flex justify-center px-4 py-2 rounded-xl bg-blue-700 text-white font-semibold hover:bg-blue-600">Project toevoegen</button>
            <div id="projectMessage" class="text-sm font-semibold md:col-span-2"></div>
          </div>

          <div class="grid gap-3" id="projectList"></div>
        </div>
      </div>

      <div class="border-t pt-6 space-y-6" id="projectWorkArea">
        <div class="flex items-center justify-between flex-wrap gap-3">
          <div>
            <h3 class="font-semibold">Projectadministratie</h3>
            <p class="text-sm text-gray-600">Koppel EPD's aan fasen A1-A3 en D, vul handmatig aan en registreer transport/aanleg-profielen per project.</p>
          </div>
          <div class="text-xs text-gray-500">Alles wordt lokaal opgeslagen per gebruiker en per project.</div>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
          <div class="space-y-4">
            <h4 class="font-semibold">EPD inlezen</h4>
            <p class="text-sm text-gray-600">Sleep een EPD (PDF) hierheen. We detecteren indicatoren zoals MKI/ECI (€) en GWP (CO<sub>2</sub>) met synoniemen zoals "GWP total" of "GWP-t" en fasen A1-A3 of D.</p>
            <label class="border-2 border-dashed border-gray-200 rounded-xl p-5 text-center cursor-pointer hover:border-gray-400 transition dropzone">
              <input type="file" id="epdUpload" accept="application/pdf" class="hidden" />
              <div class="space-y-2">
                <p class="font-semibold">Upload EPD (PDF)</p>
                <p class="text-sm text-gray-600">Automatisch vullen met detectie van MKI/ECI en GWP per fase. Handmatige aanpassing blijft mogelijk.</p>
              </div>
            </label>
            <div id="epdResult" class="text-sm text-gray-700 bg-gray-50 border border-dashed border-gray-200 rounded-xl p-4 hidden"></div>
          </div>

          <div class="space-y-4">
            <h4 class="font-semibold">Product toevoegen aan project</h4>
            <div class="grid grid-cols-2 gap-3" id="materialForm">
              <label class="space-y-1 col-span-2">
                <span class="grid-label">Actief project</span>
                <select id="activeProjectSelect" class="w-full border rounded-xl px-3 py-2"></select>
              </label>
              <label class="space-y-1">
                <span class="grid-label">Materiaal</span>
                <input id="materialName" type="text" class="w-full border rounded-xl px-3 py-2" placeholder="Asfalt AC 16" />
              </label>
              <label class="space-y-1">
                <span class="grid-label">Leverancier (herkomst)</span>
                <input id="supplier" type="text" class="w-full border rounded-xl px-3 py-2" placeholder="Leverancier" />
              </label>
              <label class="space-y-1">
                <span class="grid-label">Hoeveelheid</span>
                <input id="quantity" type="number" min="0" step="0.01" class="w-full border rounded-xl px-3 py-2" placeholder="0" />
              </label>
              <label class="space-y-1">
                <span class="grid-label">Eenheid</span>
                <input id="unit" type="text" class="w-full border rounded-xl px-3 py-2" placeholder="ton, m3, m2" />
              </label>
              <label class="space-y-1">
                <span class="grid-label">Transportafstand (km)</span>
                <input id="distance" type="number" min="0" step="0.1" class="w-full border rounded-xl px-3 py-2" placeholder="0" value="0" />
              </label>
              <label class="space-y-1">
                <span class="grid-label">Vervoersmiddel</span>
                <select id="transportMode" class="w-full border rounded-xl px-3 py-2">
                  <option>Vrachtwagen - Diesel Euro 5</option>
                  <option>Vrachtwagen - Elektrisch</option>
                  <option>Vrachtschip - Diesel</option>
                  <option>Trein - Elektrisch</option>
                </select>
              </label>
              <label class="space-y-1">
                <span class="grid-label">Brandstof transport</span>
                <input id="transportFuel" type="text" class="w-full border rounded-xl px-3 py-2" value="Diesel Euro 5" />
              </label>
              <label class="space-y-1">
                <span class="grid-label">Brandstof aanleg</span>
                <input id="installationFuel" type="text" class="w-full border rounded-xl px-3 py-2" value="Diesel" />
              </label>
              <div class="col-span-2 grid grid-cols-2 gap-3 bg-gray-50 border rounded-xl p-3">
                <div class="font-semibold col-span-2">Fasewaarden (MKI / CO<sub>2</sub>) per eenheid</div>
                <label class="space-y-1">
                  <span class="grid-label">A1</span>
                  <div class="flex gap-2">
                    <input id="a1Mki" type="number" step="0.0001" class="w-1/2 border rounded-xl px-3 py-2" placeholder="MKI" />
                    <input id="a1Gwp" type="number" step="0.0001" class="w-1/2 border rounded-xl px-3 py-2" placeholder="CO2" />
                  </div>
                </label>
                <label class="space-y-1">
                  <span class="grid-label">A2</span>
                  <div class="flex gap-2">
                    <input id="a2Mki" type="number" step="0.0001" class="w-1/2 border rounded-xl px-3 py-2" placeholder="MKI" />
                    <input id="a2Gwp" type="number" step="0.0001" class="w-1/2 border rounded-xl px-3 py-2" placeholder="CO2" />
                  </div>
                </label>
                <label class="space-y-1">
                  <span class="grid-label">A3</span>
                  <div class="flex gap-2">
                    <input id="a3Mki" type="number" step="0.0001" class="w-1/2 border rounded-xl px-3 py-2" placeholder="MKI" />
                    <input id="a3Gwp" type="number" step="0.0001" class="w-1/2 border rounded-xl px-3 py-2" placeholder="CO2" />
                  </div>
                </label>
                <label class="space-y-1">
                  <span class="grid-label">D</span>
                  <div class="flex gap-2">
                    <input id="dMki" type="number" step="0.0001" class="w-1/2 border rounded-xl px-3 py-2" placeholder="MKI" />
                    <input id="dGwp" type="number" step="0.0001" class="w-1/2 border rounded-xl px-3 py-2" placeholder="CO2" />
                  </div>
                </label>
              </div>
              <div class="col-span-2 space-y-2">
                <div class="flex flex-wrap items-center gap-3">
                  <h5 class="font-semibold">Eigen kolommen per project</h5>
                  <div class="text-xs text-gray-500">Worden als velden in het formulier en in de tabel getoond.</div>
                </div>
                <div class="flex gap-2 flex-wrap">
                  <input id="customColumnName" type="text" class="border rounded-xl px-3 py-2 text-sm" placeholder="Kolomnaam" />
                  <select id="customColumnType" class="border rounded-xl px-3 py-2 text-sm">
                    <option value="text">Tekst</option>
                    <option value="number">Getal</option>
                  </select>
                  <button id="addColumn" class="px-3 py-2 rounded-xl bg-blue-700 text-white text-sm hover:bg-blue-600">Kolom toevoegen</button>
                </div>
                <div id="customFields" class="grid grid-cols-2 gap-3"></div>
              </div>
              <button id="addMaterial" class="col-span-2 inline-flex justify-center px-4 py-2 rounded-xl bg-green-600 text-white font-semibold hover:bg-green-500">Product opslaan in project</button>
              <div id="formMessage" class="text-sm font-semibold col-span-2"></div>
            </div>
          </div>
        </div>

        <div class="overflow-auto">
          <table class="min-w-full text-sm" id="materialsTable">
            <thead class="bg-gray-50">
              <tr class="text-left" id="tableHeaderRow">
                <th class="px-3 py-2">Project</th>
                <th class="px-3 py-2">Materiaal</th>
                <th class="px-3 py-2">Leverancier</th>
                <th class="px-3 py-2">Hoeveelheid</th>
                <th class="px-3 py-2">Transport</th>
                <th class="px-3 py-2">Aanleg</th>
                <th class="px-3 py-2">A1 MKI / GWP</th>
                <th class="px-3 py-2">A2 MKI / GWP</th>
                <th class="px-3 py-2">A3 MKI / GWP</th>
                <th class="px-3 py-2">D MKI / GWP</th>
                <th class="px-3 py-2">Totaal MKI</th>
                <th class="px-3 py-2">Opties</th>
              </tr>
            </thead>
            <tbody id="tableBody" class="divide-y divide-gray-100"></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <script>
    const STORAGE_KEY = 'lcaUsersV2';
    const SESSION_KEY = 'lcaCurrentUser';
    const MAX_USERS = 100;
    const MAILBOX_LIMIT = 8;

    const state = {
      users: [],
      currentUserEmail: null,
    };

    const mailbox = [];
    let activeResetToken = null;

    const authMessage = document.getElementById('authMessage');
    const activeUser = document.getElementById('activeUser');
    const logoutBtn = document.getElementById('logoutBtn');
    const formMessage = document.getElementById('formMessage');
    const settingsMessage = document.getElementById('settingsMessage');
    const projectMessage = document.getElementById('projectMessage');
    const resendVerificationBtn = document.getElementById('resendVerification');
    const forgotLink = document.getElementById('forgotLink');
    const resetRequest = document.getElementById('resetRequest');
    const resetEmail = document.getElementById('resetEmail');
    const requestResetBtn = document.getElementById('requestReset');
    const resetForm = document.getElementById('resetForm');
    const resetContext = document.getElementById('resetContext');
    const newPasswordInput = document.getElementById('newPassword');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const submitResetBtn = document.getElementById('submitReset');
    const mailboxContainer = document.getElementById('mailbox');

    function loadState() {
      try {
        state.users = (JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]') || []).map(ensureUserShape);
      } catch (e) {
        state.users = [];
      }
      state.currentUserEmail = localStorage.getItem(SESSION_KEY) || null;
    }

    function saveUsers() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state.users));
    }

    function setCurrentUser(email) {
      state.currentUserEmail = email;
      if (email) localStorage.setItem(SESSION_KEY, email); else localStorage.removeItem(SESSION_KEY);
    }

    function findUser(email) {
      return state.users.find((u) => u.email === email) || null;
    }

    function setMessage(el, msg, color = 'text-green-700') {
      el.className = `text-sm font-semibold ${color}`;
      el.textContent = msg;
      if (msg) setTimeout(() => { el.textContent = ''; }, 5000);
    }

    function generateToken() {
      return Math.random().toString(36).slice(2) + Date.now().toString(36);
    }

    function ensureUserShape(user) {
      return {
        ...user,
        verified: user.verified !== false,
        verificationToken: user.verificationToken || null,
        passwordReset: user.passwordReset || null,
      };
    }

    function addMail(type, email, token) {
      const entry = { id: `${type}-${Date.now()}`, type, email, token, createdAt: new Date() };
      mailbox.unshift(entry);
      if (mailbox.length > MAILBOX_LIMIT) mailbox.pop();
      renderMailbox();
      return entry;
    }

    function renderMailbox() {
      mailboxContainer.innerHTML = '';
      if (mailbox.length === 0) {
        mailboxContainer.innerHTML = '<div class="text-sm text-gray-600">Nog geen mails verzonden.</div>';
        return;
      }
      mailbox.forEach((mail) => {
        const card = document.createElement('div');
        card.className = 'border rounded-xl p-3 bg-white shadow-sm flex items-center justify-between gap-3 flex-wrap';
        const text = document.createElement('div');
        const title = mail.type === 'verify' ? 'Verificatie' : 'Wachtwoordherstel';
        text.innerHTML = `<div class="font-semibold">${title} voor ${mail.email}</div><div class="text-xs text-gray-600">${mail.createdAt.toLocaleString('nl-NL')}</div>`;
        const action = document.createElement('button');
        action.className = 'px-3 py-2 rounded-xl text-sm bg-blue-700 text-white hover:bg-blue-600';
        if (mail.type === 'verify') {
          action.textContent = 'Verifieer e-mail';
          action.addEventListener('click', () => handleVerification(mail.token));
        } else {
          action.textContent = 'Stel wachtwoord in';
          action.addEventListener('click', () => openResetFromMail(mail));
        }
        card.appendChild(text);
        card.appendChild(action);
        mailboxContainer.appendChild(card);
      });
    }

    function showPage(isWorkspace) {
      document.getElementById('authPage').classList.toggle('hidden', isWorkspace);
      document.getElementById('workspacePage').classList.toggle('hidden', !isWorkspace);
    }

    function handleVerification(token) {
      const user = state.users.find((u) => u.verificationToken === token);
      if (!user) {
        setMessage(authMessage, 'Deze verificatielink is ongeldig of verlopen.', 'text-red-700');
        return;
      }
      user.verified = true;
      user.verificationToken = null;
      saveUsers();
      setCurrentUser(user.email);
      setMessage(authMessage, 'E-mail bevestigd. Je bent nu ingelogd.');
      renderWorkspace();
    }

    function sendVerificationEmail(user) {
      user.verificationToken = generateToken();
      addMail('verify', user.email, user.verificationToken);
      saveUsers();
      resendVerificationBtn.dataset.email = user.email;
      resendVerificationBtn.classList.remove('hidden');
      setMessage(authMessage, 'Verificatiemail verzonden. Controleer je inbox en volg de link.');
    }

    function sendResetEmail(user) {
      const token = generateToken();
      user.passwordReset = { token, expires: Date.now() + 1000 * 60 * 30 };
      saveUsers();
      addMail('reset', user.email, token);
      setMessage(authMessage, 'Als het e-mailadres bekend is, is een herstel-link verstuurd.', 'text-blue-700');
    }

    function openResetFromMail(mail) {
      resetRequest.classList.add('hidden');
      resetForm.classList.remove('hidden');
      activeResetToken = mail.token;
      resetContext.textContent = `Nieuw wachtwoord instellen voor ${mail.email}.`;
      newPasswordInput.value = '';
      confirmPasswordInput.value = '';
      resetForm.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    function ensureActiveProject(user) {
      if (!user) return;
      if (!user.projects) user.projects = [];
      if (!user.activeProjectId && user.projects.length > 0) {
        user.activeProjectId = user.projects[0].id;
      }
    }

    function renderSettings(user) {
      document.getElementById('settingsName').value = user.name || '';
      document.getElementById('settingsEmail').value = user.email;
      document.getElementById('settingsRole').value = user.settings?.role || '';
      document.getElementById('settingsUnit').value = user.settings?.preferredUnit || '';
    }

    function renderProjects(user) {
      ensureActiveProject(user);
      const list = document.getElementById('projectList');
      list.innerHTML = '';
      const count = document.getElementById('projectCount');
      count.textContent = `${user.projects.length} projecten in beheer.`;

      if (user.projects.length === 0) {
        list.innerHTML = '<div class="text-sm text-gray-600">Nog geen projecten. Voeg er hierboven een toe.</div>';
      } else {
        user.projects.forEach((project) => {
          const card = document.createElement('div');
          card.className = 'border rounded-xl p-3 flex items-start gap-3 justify-between';
          const text = document.createElement('div');
          text.innerHTML = `<div class="font-semibold">${project.name}</div><div class="text-sm text-gray-600">${project.description || 'Geen beschrijving'}</div>`;
          const actions = document.createElement('div');
          actions.className = 'flex gap-2';

          const activate = document.createElement('button');
          activate.textContent = project.id === user.activeProjectId ? 'Actief' : 'Openen';
          activate.className = `px-3 py-1 rounded-xl text-sm ${project.id === user.activeProjectId ? 'bg-green-100 text-green-800' : 'bg-blue-700 text-white hover:bg-blue-600'}`;
          activate.addEventListener('click', () => {
            user.activeProjectId = project.id;
            saveUsers();
            renderWorkspace();
          });

          const remove = document.createElement('button');
          remove.textContent = 'Verwijderen';
          remove.className = 'px-3 py-1 rounded-xl text-sm bg-red-50 text-red-700 hover:bg-red-100';
          remove.addEventListener('click', () => {
            if (!confirm('Weet je zeker dat je dit project wilt verwijderen?')) return;
            user.projects = user.projects.filter((p) => p.id !== project.id);
            if (user.activeProjectId === project.id) user.activeProjectId = user.projects[0]?.id || null;
            saveUsers();
            renderWorkspace();
          });

          actions.appendChild(activate);
          actions.appendChild(remove);
          card.appendChild(text);
          card.appendChild(actions);
          list.appendChild(card);
        });
      }

      renderProjectSelector(user);
    }

    function renderProjectSelector(user) {
      const select = document.getElementById('activeProjectSelect');
      select.innerHTML = '';
      user.projects.forEach((project) => {
        const opt = document.createElement('option');
        opt.value = project.id;
        opt.textContent = project.name;
        if (project.id === user.activeProjectId) opt.selected = true;
        select.appendChild(opt);
      });
      const disabled = user.projects.length === 0;
      select.disabled = disabled;
      document.getElementById('projectWorkArea').classList.toggle('hidden', disabled);
      if (!disabled) renderCustomColumns(user);
      renderTable();
    }

    function renderCustomColumns(user) {
      const activeProject = user.projects.find((p) => p.id === user.activeProjectId);
      if (!activeProject) return;
      if (!activeProject.customColumns) activeProject.customColumns = [];

      const customFields = document.getElementById('customFields');
      customFields.innerHTML = '';
      activeProject.customColumns.forEach((c) => {
        const label = document.createElement('label');
        label.className = 'space-y-1';
        label.innerHTML = `<span class="grid-label">${c.label}</span>`;
        const input = document.createElement('input');
        input.type = c.type === 'number' ? 'number' : 'text';
        input.id = `custom-${c.id}`;
        input.className = 'w-full border rounded-xl px-3 py-2';
        label.appendChild(input);
        customFields.appendChild(label);
      });

      const headerRow = document.getElementById('tableHeaderRow');
      headerRow.querySelectorAll('.custom-header').forEach((th) => th.remove());
      const optionsHeader = headerRow.querySelector('th:last-child');
      activeProject.customColumns.forEach((c) => {
        const th = document.createElement('th');
        th.className = 'px-3 py-2 custom-header';
        th.textContent = c.label;
        headerRow.insertBefore(th, optionsHeader);
      });
    }

    function renderTable() {
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = '';
      const user = findUser(state.currentUserEmail);
      if (!user || user.projects.length === 0) return;
      const activeProject = user.projects.find((p) => p.id === user.activeProjectId);
      if (!activeProject) return;

      activeProject.materials?.forEach((entry, idx) => {
        const tr = document.createElement('tr');
        const totalMki = calcTotalMki(entry);
        const cols = [
          activeProject.name || '–',
          entry.material || '–',
          entry.supplier || '–',
          `${entry.quantity || 0} ${entry.unit || ''}`,
          `${entry.distance || 0} km • ${entry.transportMode} (${entry.transportFuel})`,
          entry.installationFuel || 'Diesel',
          `${entry.phases.A1.mki} / ${entry.phases.A1.gwp} kg`,
          `${entry.phases.A2.mki} / ${entry.phases.A2.gwp} kg`,
          `${entry.phases.A3.mki} / ${entry.phases.A3.gwp} kg`,
          `${entry.phases.D.mki} / ${entry.phases.D.gwp} kg`,
          totalMki.toFixed(4)
        ];

        cols.forEach((c) => {
          const td = document.createElement('td');
          td.className = 'px-3 py-2 align-top';
          td.textContent = c;
          tr.appendChild(td);
        });

        (activeProject.customColumns || []).forEach((c) => {
          const td = document.createElement('td');
          td.className = 'px-3 py-2 align-top';
          td.textContent = entry.custom?.[c.id] ?? '';
          tr.insertBefore(td, tr.lastChild);
        });

        const tdActions = document.createElement('td');
        tdActions.className = 'px-3 py-2';
        const del = document.createElement('button');
        del.textContent = 'Verwijderen';
        del.className = 'text-red-700 hover:underline text-sm';
        del.addEventListener('click', () => {
          activeProject.materials.splice(idx, 1);
          saveUsers();
          renderTable();
        });
        tdActions.appendChild(del);
        tr.appendChild(tdActions);
        tbody.appendChild(tr);
      });
    }

    function calcTotalMki(entry) {
      const phaseTotal = ['A1','A2','A3','D'].reduce((sum, phase) => sum + (entry.phases[phase].mki || 0), 0);
      return phaseTotal * (entry.quantity || 0);
    }

    document.getElementById('registerBtn').addEventListener('click', () => {
      const name = document.getElementById('registerName').value.trim();
      const email = document.getElementById('registerEmail').value.trim().toLowerCase();
      const password = document.getElementById('registerPassword').value;

      if (!name || !email || password.length < 8) {
        setMessage(authMessage, 'Vul naam, e-mail en een wachtwoord van minimaal 8 tekens in.', 'text-red-700');
        return;
      }
      if (state.users.length >= MAX_USERS) {
        setMessage(authMessage, 'Registratie is tijdelijk niet beschikbaar. Neem contact op met de beheerder.', 'text-red-700');
        return;
      }
      if (findUser(email)) {
        setMessage(authMessage, 'Dit e-mailadres is al geregistreerd.', 'text-red-700');
        return;
      }

      const newUser = {
        name,
        email,
        password,
        verified: false,
        verificationToken: null,
        passwordReset: null,
        settings: { role: '', preferredUnit: '' },
        projects: [],
        activeProjectId: null,
      };
      state.users.push(newUser);
      sendVerificationEmail(newUser);
    });

    document.getElementById('loginBtn').addEventListener('click', () => {
      const email = document.getElementById('loginEmail').value.trim().toLowerCase();
      const password = document.getElementById('loginPassword').value;
      const user = findUser(email);
      if (!user || user.password !== password) {
        setMessage(authMessage, 'Onjuiste combinatie van e-mail en wachtwoord.', 'text-red-700');
        return;
      }
      if (!user.verified) {
        setMessage(authMessage, 'Bevestig eerst je e-mailadres via de verificatiemail.', 'text-amber-700');
        resendVerificationBtn.dataset.email = email;
        resendVerificationBtn.classList.remove('hidden');
        return;
      }
      setCurrentUser(email);
      setMessage(authMessage, `Welkom terug, ${user.name}!`);
      renderWorkspace();
    });

    logoutBtn.addEventListener('click', () => {
      setCurrentUser(null);
      setMessage(authMessage, 'Je bent uitgelogd.');
      activeUser.textContent = '';
      resendVerificationBtn.classList.add('hidden');
      resetRequest.classList.add('hidden');
      resetForm.classList.add('hidden');
      showPage(false);
    });

    resendVerificationBtn.addEventListener('click', () => {
      const email = resendVerificationBtn.dataset.email;
      const user = findUser(email);
      if (user) {
        sendVerificationEmail(user);
      }
    });

    forgotLink.addEventListener('click', () => {
      resetForm.classList.add('hidden');
      resetRequest.classList.remove('hidden');
      setMessage(authMessage, 'Vul je e-mailadres in om een herstel-link te ontvangen.', 'text-blue-700');
    });

    requestResetBtn.addEventListener('click', () => {
      const email = resetEmail.value.trim().toLowerCase();
      const user = findUser(email);
      if (user) {
        sendResetEmail(user);
      } else {
        setMessage(authMessage, 'Als het e-mailadres bekend is, is een herstel-link verstuurd.', 'text-blue-700');
      }
      resetRequest.classList.add('hidden');
    });

    submitResetBtn.addEventListener('click', () => {
      if (!activeResetToken) {
        setMessage(authMessage, 'Open de herstel-link vanuit de mail om een nieuw wachtwoord te kiezen.', 'text-red-700');
        return;
      }
      const pwd = newPasswordInput.value;
      const confirm = confirmPasswordInput.value;
      if (pwd.length < 8) {
        setMessage(authMessage, 'Wachtwoord moet minimaal 8 tekens bevatten.', 'text-red-700');
        return;
      }
      if (pwd !== confirm) {
        setMessage(authMessage, 'Wachtwoorden komen niet overeen.', 'text-red-700');
        return;
      }
      const user = state.users.find((u) => u.passwordReset?.token === activeResetToken);
      if (!user) {
        setMessage(authMessage, 'Herstellink is ongeldig of al gebruikt.', 'text-red-700');
        return;
      }
      if (user.passwordReset.expires < Date.now()) {
        setMessage(authMessage, 'Herstellink is verlopen. Vraag een nieuwe aan.', 'text-red-700');
        return;
      }
      user.password = pwd;
      user.passwordReset = null;
      saveUsers();
      setCurrentUser(user.email);
      setMessage(authMessage, 'Wachtwoord bijgewerkt. Je bent nu ingelogd.');
      resetForm.classList.add('hidden');
      activeResetToken = null;
      renderWorkspace();
    });

    document.getElementById('saveSettings').addEventListener('click', () => {
      const user = findUser(state.currentUserEmail);
      if (!user) return;
      user.name = document.getElementById('settingsName').value.trim();
      user.settings = {
        role: document.getElementById('settingsRole').value.trim(),
        preferredUnit: document.getElementById('settingsUnit').value.trim(),
      };
      saveUsers();
      setMessage(settingsMessage, 'Instellingen opgeslagen.');
      renderWorkspace();
    });

    document.getElementById('addProject').addEventListener('click', () => {
      const user = findUser(state.currentUserEmail);
      if (!user) {
        setMessage(projectMessage, 'Log in of registreer eerst.', 'text-red-700');
        return;
      }
      const name = document.getElementById('projectName').value.trim();
      const description = document.getElementById('projectDescription').value.trim();
      if (!name) {
        setMessage(projectMessage, 'Voer een projectnaam in.', 'text-red-700');
        return;
      }
      const project = {
        id: `project-${Date.now()}-${Math.random().toString(16).slice(2)}`,
        name,
        description,
        materials: [],
        customColumns: [],
      };
      user.projects.push(project);
      user.activeProjectId = project.id;
      saveUsers();
      setMessage(projectMessage, 'Project toegevoegd en geactiveerd.');
      document.getElementById('projectName').value = '';
      document.getElementById('projectDescription').value = '';
      renderWorkspace();
    });

    document.getElementById('addColumn').addEventListener('click', () => {
      const user = findUser(state.currentUserEmail);
      if (!user) return;
      const activeProject = user.projects.find((p) => p.id === user.activeProjectId);
      if (!activeProject) return;
      const label = document.getElementById('customColumnName').value.trim();
      const type = document.getElementById('customColumnType').value;
      if (!label) return setMessage(formMessage, 'Voeg een kolomnaam toe.', 'text-red-700');
      const id = `col-${Date.now()}-${Math.random().toString(16).slice(2)}`;
      activeProject.customColumns.push({ id, label, type });
      saveUsers();
      document.getElementById('customColumnName').value = '';
      renderCustomColumns(user);
      setMessage(formMessage, `Kolom "${label}" toegevoegd aan project.`);
    });

    document.getElementById('activeProjectSelect').addEventListener('change', (e) => {
      const user = findUser(state.currentUserEmail);
      if (!user) return;
      user.activeProjectId = e.target.value;
      saveUsers();
      renderWorkspace();
    });

    document.getElementById('addMaterial').addEventListener('click', () => {
      const user = findUser(state.currentUserEmail);
      if (!user) return setMessage(formMessage, 'Log in of registreer om materialen te registreren.', 'text-red-700');
      const activeProject = user.projects.find((p) => p.id === user.activeProjectId);
      if (!activeProject) return setMessage(formMessage, 'Voeg eerst een project toe.', 'text-red-700');

      const material = {
        material: document.getElementById('materialName').value.trim(),
        supplier: document.getElementById('supplier').value.trim(),
        quantity: parseFloat(document.getElementById('quantity').value) || 0,
        unit: document.getElementById('unit').value.trim() || user.settings?.preferredUnit || '',
        distance: parseFloat(document.getElementById('distance').value) || 0,
        transportMode: document.getElementById('transportMode').value,
        transportFuel: document.getElementById('transportFuel').value.trim() || 'Diesel Euro 5',
        installationFuel: document.getElementById('installationFuel').value.trim() || 'Diesel',
        phases: {
          A1: { mki: parseFloat(document.getElementById('a1Mki').value) || 0, gwp: parseFloat(document.getElementById('a1Gwp').value) || 0 },
          A2: { mki: parseFloat(document.getElementById('a2Mki').value) || 0, gwp: parseFloat(document.getElementById('a2Gwp').value) || 0 },
          A3: { mki: parseFloat(document.getElementById('a3Mki').value) || 0, gwp: parseFloat(document.getElementById('a3Gwp').value) || 0 },
          D:  { mki: parseFloat(document.getElementById('dMki').value) || 0, gwp: parseFloat(document.getElementById('dGwp').value) || 0 },
        },
        custom: {},
      };

      activeProject.customColumns.forEach((c) => {
        const input = document.getElementById(`custom-${c.id}`);
        const value = input?.value ?? '';
        material.custom[c.id] = c.type === 'number' ? Number(value) || 0 : value;
      });

      activeProject.materials.push(material);
      saveUsers();
      renderTable();
      setMessage(formMessage, 'Materiaal opgeslagen in het actieve project.');
    });

    async function parsePdf(file) {
      const pdf = await window.pdfjsLib.getDocument(await file.arrayBuffer()).promise;
      let text = '';
      for (let i = 0; i < pdf.numPages; i++) {
        const page = await pdf.getPage(i + 1);
        const content = await page.getTextContent();
        text += content.items.map((c) => c.str).join(' ') + '\n';
      }
      return text;
    }

    function findIndicator(text, phaseLabel, indicators) {
      for (const indicator of indicators) {
        const pattern = new RegExp(`${phaseLabel}[^\n]{0,60}?${indicator}[^\d-]*([-+]?[\d.,]+)`, 'i');
        const match = text.match(pattern);
        if (match) return parseFloat(match[1].replace(',', '.'));
      }
      return null;
    }

    function extractEpd(text) {
      const mkiIndicators = ['MKI', 'ECI', '€'];
      const gwpIndicators = ['GWP total', 'GWP-t', 'GWP t', 'GWP'];
      const phases = ['A1', 'A2', 'A3', 'A1-A3', 'D'];
      const data = { A1:{}, A2:{}, A3:{}, D:{} };

      phases.forEach((phase) => {
        const mki = findIndicator(text, phase, mkiIndicators);
        const gwp = findIndicator(text, phase, gwpIndicators);
        if (phase === 'A1-A3') {
          ['A1','A2','A3'].forEach((p) => {
            if (mki !== null && data[p].mki == null) data[p].mki = mki;
            if (gwp !== null && data[p].gwp == null) data[p].gwp = gwp;
          });
        } else {
          if (mki !== null) data[phase].mki = mki;
          if (gwp !== null) data[phase].gwp = gwp;
        }
      });

      return data;
    }

    document.getElementById('epdUpload').addEventListener('change', async (event) => {
      const file = event.target.files?.[0];
      if (!file) return;
      const resultBox = document.getElementById('epdResult');
      resultBox.classList.add('hidden');
      resultBox.textContent = 'Lezen...';
      try {
        const text = await parsePdf(file);
        const data = extractEpd(text);
        const fields = {
          a1Mki: data.A1.mki,
          a1Gwp: data.A1.gwp,
          a2Mki: data.A2.mki,
          a2Gwp: data.A2.gwp,
          a3Mki: data.A3.mki,
          a3Gwp: data.A3.gwp,
          dMki: data.D.mki,
          dGwp: data.D.gwp
        };

        let filled = 0;
        Object.entries(fields).forEach(([id, value]) => {
          if (value !== undefined && value !== null && !Number.isNaN(value)) {
            document.getElementById(id).value = value;
            filled++;
          }
        });

        resultBox.innerHTML = `<div class="font-semibold mb-1">EPD gelezen</div>
          <div class="text-sm text-gray-700">Herkenningsresultaat: ${filled} velden gevuld op basis van indicatoren (MKI/ECI of GWP). Pas handmatig aan waar nodig.</div>`;
        resultBox.classList.remove('hidden');
      } catch (err) {
        resultBox.textContent = 'Kon EPD niet lezen. Probeer het opnieuw of vul handmatig in.';
        resultBox.classList.remove('hidden');
        console.error(err);
      }
    });

    function renderWorkspace() {
      const user = findUser(state.currentUserEmail);
      const loggedIn = Boolean(user && user.verified);
      showPage(loggedIn);
      if (!loggedIn) {
        setCurrentUser(null);
        return;
      }

      activeUser.textContent = `Ingelogd als ${user.name} (${user.email})`;
      renderSettings(user);
      renderProjects(user);
    }

    loadState();
    renderMailbox();
    renderWorkspace();
  </script>
  <script>
    const nav = document.getElementById('nav');
    if (nav) {
      let lastY = window.scrollY;
      nav.classList.add('scroll-up');
      window.addEventListener('scroll', () => {
        const y = window.scrollY;
        if (y > lastY && y > 80) {
          nav.classList.add('scroll-down');
          nav.classList.remove('scroll-up');
        } else {
          nav.classList.add('scroll-up');
          nav.classList.remove('scroll-down');
        }
        lastY = y;
      }, { passive: true });
    }
  </script>
</body>
</html>
